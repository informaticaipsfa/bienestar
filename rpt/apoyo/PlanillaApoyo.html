<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <style>
        .filaconcep{
            font-size: 12px;
        }
        .bordeado {
            border: black 1px solid;
        }

        .biz {
            border-left: black 1px solid;
        }

        .bde {
            border-right: black 1px solid;
        }

        .btop {
            border-top: black 1px solid;
        }

        .bajo {
            border-bottom: black 1px solid;
        }

        .contenedor {
            width: 1000px;

        }

        .tcontenedor {
            width: 100%;
        }

        .textoCenter {
            text-align: center;
        }

        .texto12 {
            font-size: 12px;
        }

        .texto10 {
            font-size: 10px;
        }

        .doble {
            height: 30px;
        }

        .simple {
            height: 20px;
        }

        .fondo {
            background-color: #979a93;
        }

        .junta {
            border-collapse: collapse;
        }
    </style>
    <link rel="stylesheet" href="../../../bower_components/pace/themes/orange/pace-theme-loading-bar.css">
    <script data-pace-options='{ "ajax": false }' src="../../../bower_components/pace/pace.min.js"></script>
</head>
<body>
<center>
    <div class="contenedor">

        <table class="tcontenedor" border=0>
            <tr>
                <td style="width: 38%"><img src="../../../images/lg.png" style="float: left">
                    <center><p style="font-size: 8px"> REPUBLICA BOLIVARIANA DE VENEZUELA <br> MINISTERIO DEL PODER
                        POPULAR PARA LA DEFENSA<br>VICEMINISTERIO DE SERVICIOS<br>DIRECCIÓN GENERAL DE EMPRESAS Y SERVICIOS<br>
                        INSTITUTO DE PREVINSIÓN SOCIAL DE LA FUERZA ARMADA<br>
                        GERECIA DE BIENESTAR Y SEGURIDAD</p></center>
                </td>

                <td class="textoCenter" rowspan="2">
                    <h4>SOLICITUD DE APOYO<br>ECONÓMICO POR GASTOS M&Eacute;DICOS</h4>
                </td>
                <td class="biz bde btop bajo" style="width: 25%">
                    N° DE SOLITUD: <b id="lblnsolicitud"></b><br><br>
                    FECHA: <b id="lblfecha"></b>
                </td>

            </tr>
        </table>


        <table class="tcontenedor junta" border=1>
            <tr class="texto12">
                <td class="textoCenter " style="width:10%;">UEL</td>
                <td style="width:35%;" align="center">PROYECTO</td>
                <td style="width:40%;" align="center">ACCION ESPECIFICA</td>
            </tr>
            <tr class="texto10" style="height:30px;">
                <td class="textoCenter" style="width:10%;font-size: 15px">
                    3221
                </td>
                <td style="width:35%;" align="center">
                    <font style="font-size: 9px">
                        ADMINISTRACION DE LOS RECURSOS DEL FONDO DE CUIDADO INTEGRAL<BR>
                        DE LA SALUD PERSONAL MILITAR Y SUS FAMILIARES CON DERECHO
                    </font>
                </td>
                <td style="width:40%;" align="center">
                    <font style="font-size: 9px">
                        ADMINISTRACION DE LOS RECURSOS DEL FONDO DE CUIDADO INTEGRAL<BR>
                        DE LA SALUD PERSONAL MILITAR Y SUS FAMILIARES CON DERECHO
                    </font>
                </td>
            </tr>

        </table>


        <table class="tcontenedor junta" border=0>
            <thead>
            <tr>
                <td><h3>Datos:</h3></td>
            </tr>
            </thead>
            <tbody>
            <tr class="texto12 simple" style="height: 30px;">
                <td style="width:30%;" class="biz bde btop">
                    CEDULA DE IDENTIDAD DEL AFILIADO:
                    <br><h3><b id="lblcedula"></b></h3>
                </td>
                <td style="width:70%;" colspan="3" class="bde btop">APELLIDOS Y NOMBRES DEL AFILIADO:
                    <br><h3><b id="lblnombre"></h3></b>
                </td>
            </tr>



            <tr class="texto12">
                <td style="width:25%;" class="biz bde btop">
                    GRADO:<br>
                </td>
                <td style="width:25%;" class="bde btop">COMPONENTE:
                    <br>
                </td>
                <td style="width:25%;" class="bde btop">SITUACI&Oacute;N:</td>
                <td style="width:25%;" class="bde btop">ESTADO CIVIL:</td>
            </tr>

            <tr class="texto12 simple" style="font-size: 12px">
                <td style="width:25%; " class="biz bde bajo"><font style="font-size: 12px">
                    <b id="lblgrado"></b></font>
                </td>
                <td style="width:25%;" class="bde bajo"><font style="font-size: 12px">
                    <b id="lblcomponente"></b></font>
                </td>
                <td style="width:25%;" class="biz bde bajo"><font style="font-size: 12px">
                    <b id="lblsituacion"></b></font>
                </td>
                <td style="width:25%;" class="biz bde bajo"><font style="font-size: 12px">
                    <b id="lblestadocivil"></b></font>
                </td>
            </tr>
            <tr class="texto12">
                <td style="width:30%;" class="biz bde btop">CEDULA DE IDENTIDAD SOBREVIVIENTE:</td>
                <td style="width:70%;" colspan="3" class="bde">APELLIDOS Y NOMBRES DEL SOBREVIVIENTE:</td>
            </tr>
            <tr class="texto12 doble">
                <td style="width:30%;" class="biz bde bt bajo"></td>
                <td style="width:70%;" colspan="3" class="bde bajo"></td>
            </tr>
            <tr class="texto12">
                <td colspan="4" class="biz bde btop" class="bde btop">DIRECCION O DEPENDENCIA:</td>
            </tr>
            <tr class="texto12 doble">
                <td colspan="4" class="biz bde bajo"><p id="lbldireccion"></p></td>
            </tr>
            <tr class="texto12">
                <td colspan="2" class="biz bde btop">CORREO ELECTRONICO:</td>
                <td class="bde btop">TEL&Eacute;FONO HABITACI&Oacute;N:</td>
                <td class="bde">MOVIL/CELULAR:</td>
            </tr>
            <tr class="texto12 doble">
                <td colspan="2" class="biz bde  bajo"><label id="lblcorreo"></label></td>
                <td class="bde bajo"><label id="lbltel"></label></td>
                <td class="bde bajo"><label id="lblccel"></label></td>
            </tr>
            </tbody>
        </table>
        <br>
        <h3>DATOS DEL APOYO ECONÓMICO.</h3>
        <table class="tcontenedor junta " border="1">
            <tr class="texto12 doble">
                <td style="width:10%;text-align: center;"><b>PARENTESCO</b></td>
                <td style="width:10%;text-align: center;"><b>CEDULA</b></td>
                <td style="width:15%;text-align: center;"><b>NOMBRE DEL FAMILIAR</td>
                <td style="width:15%;text-align: center;"><b>CONCEPTO</b></td>
                <td style="width:10%;text-align: center;"><b>FACTURA</b></td>
                <td style="width:10%;text-align: center;"><b>FECHA</b></td>
                <td style="width:15%;text-align: center;"><b>MONTO SOLICITADO</b></td>
                <td style="width:15%;text-align: center;"><b>MONTO A CUBRIR ASEGURADORA</b></td>
                <td style="width:15%;text-align: center;"><b>OTROS APORTES</b></td>
                <!--<td style="width:5%" align="center">%</td>-->
                <td style="width:10%;text-align: center;"><b>MONTO CUBRIR IPSFA</b></td>
            </tr>
            <tbody id="cuerpoConceptos">

            </tbody>

            <tr class="doble">
                <td colspan="9" style="text-align: right">MONTO TOTAL A CUBRIR POR EL IPSFA&nbsp;&nbsp;&nbsp;</td>
                <!-- <td style="text-align: right"><label id="lblmontot"></label></td> -->
                <td> <label id="lblmontotApro"></label></td>
            </tr>


        </table>
        <!--<h3>CUENTA EN LA CUAL DESEA QUE SE LE DEPOSITE EL MONTO.</h3>-->
        <!--<table class="tcontenedor junta" border="0">-->
            <!--<tr class="texto12">-->
                <!--<td style="width:60%" colspan="2" class="biz bde btop ">NUMERO DE CUENTA<br></td>-->
                <!--<td class="biz bde btop">BANCO</td>-->
                <!--<td class="bde btop bde">TIPO DE CUENTA</td>-->
            <!--</tr>-->
            <!--<tr class="simple">-->
                <!--<td colspan="2" class="biz bde  bajo"><p id="lblcuenta"></p></td>-->
                <!--<td class="biz bde  bajo">-->
                    <!--<label id="lblbanco"></label>-->
                <!--</td>-->
                <!--<td class=" bde  bajo">-->
                    <!--<label id="lbltipoc"></label>-->
                <!--</td>-->
            <!--</tr>-->

        <!--</table>-->
        <br>

        <table class="tcontenedor junta" border="0">
            <tr class="texto12">
                <td style="width:100%" colspan="4" class="bordeado textoCenter"><h3>GERENCIA DE BIENESTAR Y SEGURIDAD
                    SOCIAL</h3>
            </tr>
            <tr class="texto12">
                <td style="width:50%" class="biz bde ">REVISADO POR JEFE SECCI&Oacute;N TRAMITACI&Oacute;N Y
                    SERVICIOS M&Eacute;DICOS
                </td>
                <td style="width:20%">FIRMA</td>
                <td class="bde"></td>
                <td style="width:20%" class="bordeado">FECHA</td>
            </tr>
            <tr class="simple">
                <td class="biz bde  bajo"></td>
                <td class="bajo"></td>
                <td class="bde  bajo"></td>
                <td class="bordeado">
                    <table class="tcontenedor">
                        <tr class="simple">
                            <td style="width:30%;" class="bde"></td>
                            <td style="width:30%;" class="bde"></td>
                            <td style="width:40%;"></td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr class="texto12">
                <td colspan="2" class="biz bde ">OPINI&Oacute;N DEL JEFE DE DEPARTAMENTO CUIDADO INTEGRAL DE LA SALUD:
                </td>
                <td colspan="2" class="biz bde ">FIRMA</td>
            </tr>
            <tr class="simple">
                <td colspan="2" class="biz bde  bajo"><b>A Consideración del Gerente BYSS</b></td>
                <td colspan="2" class="bde  bajo"></td>
            </tr>
            <tr class="texto12">
                <td colspan="2" class="biz bde ">OPINI&Oacute;N DEL GERENTE DE BIENESTAR Y SEGURIDAD SOCIAL:</td>
                <td colspan="2" class="bde">FIRMA</td>
            </tr>
            <tr class="simple">
                <td colspan="2" class="biz bde  bajo"><b>Apoyar Con</b></td>
                <td colspan="2" class="bde  bajo"></td>
            </tr>
        </table>
        <br>
        <table class="tcontenedor junta" border="0">
            <tr class="texto12">
                <td style="width:50%" class="biz bde  btop">DECISI&Oacute;N DEL PRESIDENTE DE LA JUNTA ADMINISTRATIVA
                    DEL IPSFA.
                </td>
                <td style="width:30%" class="bde  btop">FIRMA</td>
                <td style="width:20%" class="bordeado">FECHA</td>
            </tr>
            <tr class="doble">
                <td class="biz bde  bajo"></td>
                <td class="bde  bajo"></td>
                <td class="bordeado">
                    <table class="tcontenedor">
                        <tr class="simple">
                            <td style="width:30%;" class="bde"></td>
                            <td style="width:30%;" class="bde"></td>
                            <td style="width:40%;"></td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
        <p style="width:100%;font-size: 10px" class"textoCenter">GERENCIA DE FINANZAS DPTO. DE CONTABILIDAD</p>

    </div>

    <div id="btnImprimir">
        <br>
        <input type="button" value="Imprimir" onclick="imprimir()">
    </div>
</center>

</body>


<script src="../../../bower_components/jquery/dist/jquery.min.js"></script>
<script src="../../../bower_components/formato/numeral.js"></script>

<script src="../../js/utilidad.js"></script>
<script src="../../js/militar.js"></script>
<script src="../../js/config.js"></script>
<script src="../../js/controlador.js"></script>
<script>

    function imprimir() {
        $('#btnImprimir').hide();
        window.print();
        window.close();
    }

    let pos = '';
    $(function () {
        numeral.locale('es-es');
        $.obtener = function (key) {
            key = key.replace(/[\[]/, '\\[');
            key = key.replace(/[\]]/, '\\]');
            var pattern = "[\\?&]" + key + "=([^&#]*)";
            var regex = new RegExp(pattern);
            var url = unescape(window.location.href);
            var results = regex.exec(url);
            if (results === null) {
                return null;
            } else {
                return results[1];
            }
        };
        var id = $.obtener("id");
        pos = $.obtener("pos");
        Buscar(id);
    });

    function Buscar(id) {
        if (id != undefined) {
            $("#_cedula").val(id);
        }
        if ($("#_cedula").val() == "") {
            return false;
        }

        var url = Conn.URL + "militar/crud/" +id;
        var request = CargarAPI({
            sURL: url,
            metodo: 'GET',
            valores: '',
            Objeto: militar
        });

        request.then(function (xhRequest) {
            militar = JSON.parse(xhRequest.responseText);
            llenar(id);
        });


        //CargarAPI(url, "GET", "", militar);


    }

    function llenar(formato) {
        if (formato != undefined) {

        }

        if (militar.Persona != undefined) {
            var ncompleto = militar.Persona.DatoBasico.nombreprimero + " " + militar.Persona.DatoBasico.apellidoprimero;
            $("#lblnombre").text(ncompleto);

            $("#lblcomponente").text(militar.Componente.descripcion);

            $("#lblgrado").text(militar.Grado.descripcion);

            $("#lblcedula").text(militar.Persona.DatoBasico.cedula);

            crearLista();

            var estcivil = Util.GenerarEstadoCivil(militar.Persona.DatoBasico.estadocivil, militar.Persona.DatoBasico.sexo);

            $("#lblestadocivil").text(estcivil);

            $("#lblsituacion").text(Util.ConvertirSitucacion(militar.situacion));
            var defestados = JSON.parse(sessionStorage.getItem("ipsfaEstado"));
            if (militar.Persona.Direccion != undefined) {
                var DIR = militar.Persona.Direccion[0];
                Estados.ObtenerEstados();
                var estado = "";

                $.each(defestados,function(){
                    if(this.codigo == DIR.estado){
                        estado = this.nombre;
                    }
                });

                var rirec ="ESTADO "+ estado + ", CIUDAD " + DIR.ciudad + ", MUNICIPIO " + DIR.municipio + ", PARROQUIA " + DIR.parroquia + ", AV/CALLE " + DIR.calleavenida + ", CASA/APT " + DIR.casa + "|" + DIR.apartamento
                $("#lbldireccion").text(rirec);
            }

        } else {
            alert("Cedula no se encuentra registrada como militar dentro del sistema");
        }
    }

    function crearLista() {
        if(pos == null){
            pos=militar.CIS.ServicioMedico.Programa.Apoyo.length;
            pos--;
        }
        var apo = militar.CIS.ServicioMedico.Programa.Apoyo[pos];
        $("#lblnsolicitud").text(apo.numero);
        $("#lblfecha").text(Util.ConvertirFechaHumana(apo.fechacreacion));
        $("#lblbanco").text(Util.ConvertirBanco(apo.CuentaBancaria.institucion));
        $("#lblcuenta").text(apo.CuentaBancaria.cuenta);

        var tipoc = apo.CuentaBancaria.tipo=="CA" ? "CUENTA DE AHORRO":"CUENTA CORRIENTE";
        $("#lbltipoc").text(tipoc);

        var concep = militar.CIS.ServicioMedico.Programa.Apoyo[pos];
        var fila ="";
        var totalAs = 0;
        concep.Concepto.forEach(v => {
            var porcen = v.DatoFactura.montoaprobado * 100 / v.DatoFactura.monto;
            var bene = v.afiliado.split("-");
            var paren = bene[1].split("(");
            var tam = paren[1].length;
            var mntformato = numeral(parseFloat(v.DatoFactura.monto)).format('0,0.00');
            // $("#lblmontot").text(mntformato);
            var mntaseguradora = numeral(parseFloat(v.montoaseguradora)).format('0,0.00');
            var mntotrosaportes = numeral(parseFloat(v.montoaportar)).format('0,0.00');
            var mntformato2 = numeral(parseFloat(apo.montosolicitado)).format('0,0.00');
            //console.log(apo);
            var montoIPSFA = parseFloat(v.montosolicitado) - (parseFloat(v.montoaportar)+parseFloat(v.montoaseguradora));
            totalAs +=  montoIPSFA;
            var mntIPSFA = numeral(montoIPSFA).format('0,0.00');
            fila += `<tr class='filaconcep'>
                <td>${paren[1].substring(0,(tam-1))}</td>
                <td>${bene[0]}</td>
                <td>${paren[0]}</td>
                <td>${v.descripcion}</td>
                <td>${v.DatoFactura.numero}</td>
                <td>${Util.ConvertirFechaHumana(v.DatoFactura.fecha)}</td>
                <td style='text-align: right'>${mntformato}</td>
                <td style='text-align: right'>${mntaseguradora}</td>
                <td style='text-align: right'>${mntotrosaportes}</td>
                <td style='text-align: right'>${mntIPSFA}</td>
                </tr>`;
        });
        $("#lblmontotApro").text(numeral(parseFloat(totalAs)).format('0,0.00'));
        $("#cuerpoConceptos").html(fila);
    }
</script>
</html>
